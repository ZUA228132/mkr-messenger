# üîç –û—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±—ç–∫–µ–Ω–¥–∞ MKR Messenger

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 17 —è–Ω–≤–∞—Ä—è 2026  
**–°–µ—Ä–≤–µ—Ä:** 193.111.117.137 (–ü–æ–ª—å—à–∞ üáµüá±)  
**–û–°:** Ubuntu 24.04

---

## ‚úÖ –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. Backend Application (Ktor)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ü—Ä–æ—Ü–µ—Å—Å:** PID 700960
- **–ü–æ—Ä—Ç:** 8080 (—Å–ª—É—à–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö)
- **Java –≤–µ—Ä—Å–∏—è:** OpenJDK 17.0.17
- **JAR —Ñ–∞–π–ª:** `/opt/pioneer/pioneer-backend.jar` (36.4 MB)
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/opt/pioneer/application.conf`
- **–õ–æ–≥–∏:** `/opt/pioneer/logs/`

### 2. PostgreSQL Database
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–í–µ—Ä—Å–∏—è:** PostgreSQL 16
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `pioneer`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `pioneer`
- **–ü–æ—Ä—Ç:** 5432 (localhost only)
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è:** 10 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### 3. API Endpoints
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - ‚úÖ POST `/api/auth/login/email` - —Ä–∞–±–æ—Ç–∞–µ—Ç
  - ‚úÖ POST `/api/auth/register/email` - —Ä–∞–±–æ—Ç–∞–µ—Ç
  - ‚úÖ GET `/api/users` - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã (28 —à—Ç—É–∫)
- ‚úÖ `users` - 17 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ `chats` - 18 —á–∞—Ç–æ–≤
- ‚úÖ `messages` - —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ `channels` - –∫–∞–Ω–∞–ª—ã
- ‚úÖ `channel_posts` - –ø–æ—Å—Ç—ã –≤ –∫–∞–Ω–∞–ª–∞—Ö
- ‚úÖ `channel_subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ `device_tokens` - FCM —Ç–æ–∫–µ–Ω—ã
- ‚úÖ `call_history` - –∏—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ `map_markers` - –º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
- ‚úÖ `tasks` - –∑–∞–¥–∞—á–∏
- ‚úÖ `finance_records` - —Ñ–∏–Ω–∞–Ω—Å—ã
- ‚úÖ `invite_keys` - –∫–ª—é—á–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
- ‚úÖ `stories` - –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ `reels` - reels
- ‚úÖ `music_rooms` - –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã
- ‚úÖ `web_sessions` - –≤–µ–±-—Å–µ—Å—Å–∏–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```
ID                                   | Username  | Email         | Access Level | Verified
-------------------------------------|-----------|---------------|--------------|----------
7d290a00-f680-4b08-b464-efbf90bc7e9a | Makar     |               | 10 (Admin)   | Yes
system-admin                         | system    |               | 100 (Super)  | Yes
387786c4-95de-434d-961b-763a7c10507a | testcheck |               | 10 (Admin)   | Yes
9f153534-f237-48e6-9a52-5f407b2cd330 | Test      |               | 1 (User)     | Yes
fb66e8fd-8046-4786-9d6a-cf79f28dfdbe | iva       | ipboom@bk.ru  | 1 (User)     | Yes
```

---

## ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. WebSocket –æ—à–∏–±–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω—ã –æ—à–∏–±–∫–∏ `CompletionHandlerException` –∏ `RejectedExecutionException`
```
Exception in thread "eventLoopGroupProxy-3-3" kotlinx.coroutines.CompletionHandlerException
Caused by: java.util.concurrent.RejectedExecutionException: event executor terminated
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–∫—Ä—ã—Ç–∏–µ–º WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç. –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –Ω–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ `WebSockets.kt`

### 2. Systemd —Å–µ—Ä–≤–∏—Å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
**–ü—Ä–æ–±–ª–µ–º–∞:** Backend –∑–∞–ø—É—â–µ–Ω –≤—Ä—É—á–Ω—É—é, –Ω–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å systemd unit —Ñ–∞–π–ª `/etc/systemd/system/pioneer-backend.service`

### 3. –ù–µ—Ç health endpoint
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `GET /api/health` endpoint

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (—Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å)

1. **–°–æ–∑–¥–∞—Ç—å systemd —Å–µ—Ä–≤–∏—Å**
   ```bash
   # /etc/systemd/system/pioneer-backend.service
   [Unit]
   Description=Pioneer MKR Backend
   After=network.target postgresql.service
   
   [Service]
   Type=simple
   User=root
   WorkingDirectory=/opt/pioneer
   ExecStart=/usr/bin/java -Dconfig.file=/opt/pioneer/application.conf -jar /opt/pioneer/pioneer-backend.jar
   Restart=always
   RestartSec=10
   
   [Install]
   WantedBy=multi-user.target
   ```

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å WebSocket –æ–±—Ä–∞–±–æ—Ç–∫—É**
   - –î–æ–±–∞–≤–∏—Ç—å proper cleanup –≤ `WebSockets.kt`
   - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å cancellation –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

3. **–î–æ–±–∞–≤–∏—Ç—å health endpoint**
   ```kotlin
   get("/api/health") {
       call.respond(mapOf(
           "status" to "ok",
           "timestamp" to System.currentTimeMillis(),
           "version" to "1.0.0"
       ))
   }
   ```

### –í–∞–∂–Ω—ã–µ (—Å–¥–µ–ª–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
   - –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   - –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ—à–∏–±–æ–∫

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - Prometheus metrics
   - Grafana dashboard
   - Alerting

6. **Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup PostgreSQL
   - Retention policy

7. **SSL/TLS**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS
   - Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ–∑–∂–µ)

8. **Rate limiting**
   - –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS
   - –õ–∏–º–∏—Ç—ã –Ω–∞ API endpoints

9. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Redis –¥–ª—è —Å–µ—Å—Å–∏–π
   - –ö—ç—à —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

10. **CI/CD**
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
    - –¢–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

---

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏—á–∏

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ email —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É (SMS.ru callcheck)
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
- ‚úÖ –í—Ö–æ–¥ –ø–æ email/—Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ (5 –ø–æ–ø—ã—Ç–æ–∫, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 15 –º–∏–Ω)

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–≤–∞—Ç–∞—Ä—ã
- ‚úÖ –≠–º–æ–¥–∑–∏-—Å—Ç–∞—Ç—É—Å—ã
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–≥–∞–ª–æ—á–∫–∞)
- ‚úÖ –ë–∞–Ω/—Ä–∞–∑–±–∞–Ω (–∞–¥–º–∏–Ω—ã)
- ‚úÖ –£—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞ (1-100)

#### –ß–∞—Ç—ã
- ‚úÖ –õ–∏—á–Ω—ã–µ —á–∞—Ç—ã (direct)
- ‚úÖ –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ WebSocket –¥–ª—è real-time
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚úÖ –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

#### –ö–∞–Ω–∞–ª—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ –ü–æ—Å—Ç—ã –≤ –∫–∞–Ω–∞–ª–∞—Ö
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª MKR

#### –ó–≤–æ–Ω–∫–∏
- ‚úÖ LiveKit –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –ê—É–¥–∏–æ –∑–≤–æ–Ω–∫–∏
- ‚úÖ –í–∏–¥–µ–æ –∑–≤–æ–Ω–∫–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- ‚úÖ –ö–∞—Ä—Ç–∞ —Å –º–µ—Ç–∫–∞–º–∏
- ‚úÖ –ó–∞–¥–∞—á–∏ (tasks)
- ‚úÖ –§–∏–Ω–∞–Ω—Å—ã
- ‚úÖ Stories (–∏—Å—Ç–æ—Ä–∏–∏)
- ‚úÖ Reels (–∫–æ—Ä–æ—Ç–∫–∏–µ –≤–∏–¥–µ–æ)
- ‚úÖ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã
- ‚úÖ FCM push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

---

## üìù –í—ã–≤–æ–¥—ã

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ ‚úÖ
1. Backend —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ—Ä—è–¥–∫–µ
3. API endpoints –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –ï—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –¥–∞–Ω–Ω—ã–µ
5. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏—á–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å ‚ö†Ô∏è
1. WebSocket –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
2. –ù–µ—Ç systemd —Å–µ—Ä–≤–∏—Å–∞
3. –ù–µ—Ç health endpoint
4. –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ backup

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 8/10 üéØ

Backend —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã - —ç—Ç–æ DevOps –≤–æ–ø—Ä–æ—Å—ã (systemd, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, backup), –∞ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–∞–≥–∏.

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
ps aux | grep java

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã
ss -tlnp | grep -E "(8080|5432)"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f /opt/pioneer/logs/*.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
PGPASSWORD=Pioneer2024 psql -U pioneer -d pioneer -c "SELECT COUNT(*) FROM users;"
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å backend
kill $(ps aux | grep pioneer-backend.jar | grep -v grep | awk '{print $2}')

# –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
cd /opt/pioneer
nohup java -Dconfig.file=/opt/pioneer/application.conf -jar pioneer-backend.jar > logs/backend.log 2>&1 &

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL
systemctl restart postgresql
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
```bash
# Health check (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è endpoint)
curl http://localhost:8080/api/health

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
curl -X POST http://localhost:8080/api/auth/register/email \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"test123456","username":"testuser","displayName":"Test User"}'

# –í—Ö–æ–¥
curl -X POST http://localhost:8080/api/auth/login/email \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"test123456"}'
```

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** Kiro AI  
**–î–ª—è:** MKR Messenger Team
